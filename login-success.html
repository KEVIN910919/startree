<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>登入完成</title>
</head>
<body>
  <p>授權完成，請稍候…</p>

  <pre id="debug"></pre>

  <script>
    const dbg = (t) => {
      document.getElementById("debug").textContent += t + "\n";
      console.log(t);
    };

    const token = new URLSearchParams(location.search).get("token");
    dbg("收到 token = " + token);

    if(token){
      if(window.opener){
        dbg("找到 opener，準備傳送 postMessage");
        window.opener.postMessage({ token }, "*");
        dbg("已送出 postMessage");
        dbg("⚠️ 暫停自動關閉，請手動關閉視窗");
      }else{
        dbg("❌ 找不到原視窗 window.opener");
      }
    }else{
      dbg("❌ 沒有收到 token");
    }
  </script>
</body>
</html>
